import numpy as np
import serial
import time

waitTime = 0.1

# generate the waveform table
song = np.array(
    [
        261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261,
        392, 392, 349, 349, 330, 330, 294,
        392, 392, 349, 349, 330, 330, 294,
        261, 261, 392, 392, 440, 440, 392,
        349, 349, 330, 330, 294, 294, 261,
        0,0,0,0,0,0,0,

        392, 330, 330,
        349, 294, 294,
        261, 294, 330, 349, 392, 392, 392,
        392, 330, 330,
        349, 294, 294,
        261, 330, 392, 392, 330,
        294, 294, 294, 294, 294, 330, 349,
        330, 330, 330, 330, 330, 349, 392,
        392, 330, 330, 
        349, 294, 294,
        261, 330, 392, 392, 261,


        261, 261, 294, 261, 349, 330,
        261, 261, 294, 261, 392, 349,
        261, 261, 523, 440, 349, 330,
        349, 349, 330, 261, 294, 261,
        261, 261, 294, 261, 349, 330,
        261, 261, 294, 261, 392, 349,
        261, 261, 523, 440, 349, 330,
        349, 349, 330, 261, 294, 261,
        0
    ]
)
length = np.array(
  [
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        1, 1, 1, 1, 1, 1, 2,
        0, 0, 0, 0, 0, 0, 0,
  
        1, 1, 1, 1, 1, 1, 
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 3,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 3,

        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1,
        0
  ]
)
song = song / 1000
length = length / 1000

# output formatter
formatter = lambda x: "%.3f" % x

# send the waveform table to K66F
serdev = '/dev/ttyACM0'
s = serial.Serial(serdev)
print("Sending signal ...")
print("It may take some time ..." )
for data in song:
    s.write(bytes(formatter(data), 'UTF-8'))
    time.sleep(waitTime)
for data in length:
    s.write(bytes(formatter(data), 'UTF-8'))
    time.sleep(waitTime)
    
s.close()
print("Signal sended")